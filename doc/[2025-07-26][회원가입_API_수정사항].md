# [2025-07-26] 회원가입 API 수정사항

## 수정 배경
- 회원가입 시 phone 필드 검증 오류 (400 에러) 발생
- 세션이 프론트엔드에서 처리되지 않아 아이디 중복체크 검증 로직 개선 필요

## 수정 내용

### 1. Phone 필드 검증 수정
**파일**: `src/auth/register/register.dto/register.dto.ts`
- **수정 전**: `@IsPhoneNumber()`
- **수정 후**: `@IsPhoneNumber('KR')`
- **이유**: 한국 전화번호 형식("010-5497-9683") 검증을 위해 국가 코드 지정

### 2. 아이디 중복체크 검증 로직 변경
**기존 방식**: 세션 기반 검증
**변경 방식**: DTO 필드 기반 검증

#### 2.1 RegisterDto 수정
**파일**: `src/auth/register/register.dto/register.dto.ts`
- **추가 필드**: `checkIdPerformed: boolean`
- **추가 임포트**: `IsBoolean`, `Transform` from class-validator/class-transformer
- **검증 로직**:
  ```typescript
  @Transform(({ value }) => {
      if (value === 'true') return true;
      if (value === 'false') return false;
      return value;
  })
  @IsBoolean()
  get checkIdPerformed(): boolean {
      return this._checkIdPerformed;
  }
  ```

#### 2.2 Controller 수정
**파일**: `src/auth/register/register.controller.ts`
- **변경 전**: 세션에서 `checkIdPerformed` 확인
- **변경 후**: `registerDto.checkIdPerformed` 필드에서 확인
- **세션 관련 코드 제거**: `@Session() session` 파라미터 및 세션 체크 로직 제거

## API 사용법

### 1. 아이디 중복체크 API
```
POST /register/CheckId
Body: { "userId": "phantom" }
Response: { "message": "사용 가능한 아이디입니다.", "code": "0000" }
```

### 2. 회원가입 API
```
POST /register/registerProcess
Body: {
  "userId": "phantom",
  "password": "1234",
  "confirmPassword": "1234", 
  "name": "이호연",
  "email": "phantom@dev.com",
  "phone": "010-5497-9683",
  "checkIdPerformed": true
}
```

## 프론트엔드 구현 가이드
1. 아이디 중복체크 API 호출 성공 시 클라이언트에서 `checkIdPerformed = true` 설정
2. 회원가입 요청 시 `checkIdPerformed: true` 포함하여 전송
3. 아이디 중복체크를 하지 않은 경우 서버에서 400 에러 응답

## 데이터베이스 영향
- **영향 없음**: `checkIdPerformed`는 검증용 필드로만 사용되며 DB에 저장되지 않음
- User 엔티티 및 마이그레이션 파일 수정 불필요

## 에러 처리
- Phone 필드: 한국 전화번호 형식이 아닌 경우 validation 에러
- checkIdPerformed: boolean이 아닌 경우 validation 에러 (Transform으로 문자열 자동 변환 지원)
- 아이디 중복체크 미수행: `{ "message": "아이디 중복 체크를 먼저 해주세요.", "code": "0003" }`